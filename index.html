<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Paciente</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 40px; background-color: #f0f2f5; display: flex; justify-content: center; }
        .container { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 500px; }
        
        /* Estilo del Logo */
        .logo-container { text-align: center; margin-bottom: 20px; }
        .logo-container img { max-width: 150px; height: auto; }

        h2 { text-align: center; color: #333; margin-bottom: 25px; }
        
        label { display: block; margin-top: 15px; font-weight: 600; color: #555; font-size: 14px; }
        input, select, textarea { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 16px; }
        input:focus, select:focus, textarea:focus { border-color: #007bff; outline: none; }
        
        /* Botón */
        button { margin-top: 30px; width: 100%; padding: 14px; background-color: #007bff; color: white; border: none; border-radius: 6px; font-size: 16px; font-weight: bold; cursor: pointer; transition: background 0.3s; }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }

        .mensaje { margin-top: 20px; text-align: center; font-weight: bold; padding: 10px; border-radius: 6px; }
        .obligatorio { color: red; margin-left: 3px; }
    </style>
</head>
<body>

    <div class="container">
        <div class="logo-container">
            <img src="logo.png" alt="Logo Clínica" onerror="this.style.display='none'">
        </div>

        <h2>Registro de Paciente Nuevo</h2>
        
        <form id="miFormulario">
            <label>Nombre Completo <span class="obligatorio">*</span></label>
            <input type="text" name="nombreCompleto" placeholder="Ej. Juan Pérez López" required>

            <label>Correo Electrónico <span class="obligatorio">*</span></label>
            <input type="email" name="email" placeholder="ejemplo@correo.com" required>

            <label>Teléfono Móvil <span class="obligatorio">*</span></label>
            <input type="tel" name="telefono" placeholder="10 dígitos" required>

            <label>Fecha de Nacimiento <span class="obligatorio">*</span></label>
            <input type="date" name="fechaNacimiento" required>

            <label>Género <span class="obligatorio">*</span></label>
            <select name="genero" required>
                <option value="" disabled selected>Seleccione una opción</option>
                <option value="Femenino">Femenino</option>
                <option value="Masculino">Masculino</option>
                <option value="No especificado">Prefiero no decirlo</option>
            </select>

            <label>Estado Civil <span class="obligatorio">*</span></label>
            <select name="estadoCivil" required>
                <option value="" disabled selected>Seleccione una opción</option>
                <option value="Soltero">Soltero/a</option>
                <option value="Casado">Casado/a</option>
                <option value="Divorciado">Divorciado/a</option>
                <option value="Viudo">Viudo/a</option>
                <option value="Union Libre">Unión Libre</option>
            </select>

            <label>Escolaridad</label>
            <input type="text" name="escolaridad" placeholder="Ej. Licenciatura, Preparatoria...">

            <label>Lugar de Residencia (Ciudad)</label>
            <input type="text" name="lugarResidencia" placeholder="Ej. Ciudad de México">

            <label>Historial Médico Previo (Breve)</label>
            <textarea name="historialMedicoPrevio" rows="3" placeholder="Alergias, cirugías previas, padecimientos crónicos..."></textarea>

            <button type="submit" id="btnEnviar">Guardar Registro</button>
            <div id="respuesta" class="mensaje"></div>
        </form>
    </div>

    <script>
        document.getElementById('miFormulario').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btnEnviar');
            const divRespuesta = document.getElementById('respuesta');
            
            // Bloquear botón para evitar doble clic
            btn.disabled = true;
            btn.innerText = "Procesando...";
            divRespuesta.innerText = "";
            divRespuesta.style.backgroundColor = "transparent";

            const formData = new FormData(e.target);
            const datos = Object.fromEntries(formData.entries());

            try {
                const response = await fetch('/.netlify/functions/guardarPaciente', {
                    method: 'POST',
                    body: JSON.stringify(datos)
                });

                const resultado = await response.json();

                if (response.ok) {
                    divRespuesta.style.color = '#155724';
                    divRespuesta.style.backgroundColor = '#d4edda';
                    divRespuesta.innerText = "¡Registro exitoso! Sus datos han sido guardados.";
                    e.target.reset();
                } else {
                    divRespuesta.style.color = '#721c24';
                    divRespuesta.style.backgroundColor = '#f8d7da';
                    divRespuesta.innerText = "Error: " + resultado.message;
                }
            } catch (err) {
                divRespuesta.style.color = '#721c24';
                divRespuesta.innerText = "Error de conexión. Intente nuevamente.";
            } finally {
                btn.disabled = false;
                btn.innerText = "Guardar Registro";
            }
        });
    </script>
</body>
</html>